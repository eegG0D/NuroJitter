<Window x:Class="NeuroJitter.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:NeuroJitter.ViewModels"
        xmlns:core="clr-namespace:NeuroJitter.Core"
        Title="MindWave Mobile 2 | Neuro-Jitter Dashboard" Height="700" Width="1000"
        Background="{Binding BackgroundBrush}">

    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Window.Resources>
        <!-- Converter reference -->
        <core:BooleanToVisibilityConverter x:Key="BoolToVis" />

        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{Binding TextBrush}"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
        </Style>
        <Style TargetType="ProgressBar">
            <Setter Property="Height" Value="20"/>
            <Setter Property="Margin" Value="0,2"/>
        </Style>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="250"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- HEADER -->
        <StackPanel Grid.ColumnSpan="3" Orientation="Horizontal" Margin="0,0,0,20">
            <TextBlock Text="NEURO-JITTER" FontSize="24" FontWeight="Bold" Foreground="#FF007ACC"/>
            <TextBlock Text="{Binding ConnectionStatus}" Margin="20,0,0,0" VerticalAlignment="Center" FontSize="16"/>

            <Button Content="Connect TCP" Command="{Binding ConnectCommand}" Padding="10,5" Margin="20,0,0,0"/>
            <Button Content="Toggle Theme" Command="{Binding ToggleThemeCommand}" Padding="10,5" Margin="10,0,0,0"/>

            <Border Background="{Binding SignalColor}" CornerRadius="5" Padding="10,2" Margin="20,0,0,0">
                <TextBlock Text="SIGNAL STATUS" Foreground="Black" FontWeight="Bold"/>
            </Border>
        </StackPanel>

        <!-- LEFT COLUMN: Controls & Jitter -->
        <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,20,0">
            <GroupBox Header="Controls" Foreground="{Binding TextBrush}" BorderBrush="Gray">
                <StackPanel Margin="10">
                    <CheckBox Content="Log to CSV" IsChecked="{Binding IsLogging}" Command="{Binding ToggleLogCommand}" Foreground="{Binding TextBrush}" Margin="0,5"/>
                    <CheckBox Content="Artifact Rejection" IsChecked="{Binding IgnoreArtifacts}" Foreground="{Binding TextBrush}" Margin="0,5"/>
                    <CheckBox Content="Audio Alert" IsChecked="{Binding IsAlertActive}" Foreground="{Binding TextBrush}" Margin="0,5"/>

                    <TextBlock Text="Alert Threshold:" Margin="0,10,0,0"/>
                    <Slider Minimum="0" Maximum="100" Value="{Binding AlertThreshold}" AutoToolTipPlacement="TopLeft"/>
                </StackPanel>
            </GroupBox>

            <GroupBox Header="Signal Jitter" Foreground="{Binding TextBrush}" BorderBrush="Gray" Margin="0,20,0,0">
                <StackPanel Margin="10">
                    <TextBlock Text="{Binding JitterMetric, StringFormat='Raw Variance: {0:F2}'}" FontSize="16"/>
                    <TextBlock Text="{Binding PeakFreqBand, StringFormat='Dominant: {0}'}" FontSize="14" Foreground="#FF007ACC" Margin="0,10,0,0"/>

                    <Border Background="Red" Visibility="{Binding IsBlinkDetected, Converter={StaticResource BoolToVis}}" Height="30" Margin="0,10">
                        <TextBlock Text="BLINK DETECTED" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                </StackPanel>
            </GroupBox>
        </StackPanel>

        <!-- CENTER COLUMN: Raw Graph & eSense -->
        <Grid Grid.Row="1" Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="2*"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Raw Wave -->
            <Border Background="Black" BorderBrush="Gray" BorderThickness="1" CornerRadius="4" ClipToBounds="True">
                <Canvas>
                    <Polyline Points="{Binding RawWavePoints}" Stroke="#00FF00" StrokeThickness="1"/>
                </Canvas>
            </Border>

            <!-- Gauges -->
            <Grid Grid.Row="1" Margin="0,20,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Margin="5">
                    <TextBlock Text="ATTENTION" HorizontalAlignment="Center" FontWeight="Bold"/>
                    <ProgressBar Value="{Binding Attention}" Maximum="100" Height="100" Orientation="Vertical" Foreground="Cyan">
                        <ProgressBar.Background>
                            <SolidColorBrush Color="#333"/>
                        </ProgressBar.Background>
                    </ProgressBar>
                    <TextBlock Text="{Binding Attention}" HorizontalAlignment="Center" FontSize="20"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Margin="5">
                    <TextBlock Text="MEDITATION" HorizontalAlignment="Center" FontWeight="Bold"/>
                    <ProgressBar Value="{Binding Meditation}" Maximum="100" Height="100" Orientation="Vertical" Foreground="Magenta">
                        <ProgressBar.Background>
                            <SolidColorBrush Color="#333"/>
                        </ProgressBar.Background>
                    </ProgressBar>
                    <TextBlock Text="{Binding Meditation}" HorizontalAlignment="Center" FontSize="20"/>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- RIGHT COLUMN: Spectral Analysis -->
        <ScrollViewer Grid.Row="1" Grid.Column="2" Margin="20,0,0,0">
            <StackPanel>
                <TextBlock Text="POWER BANDS (FFT)" FontWeight="Bold" Margin="0,0,0,10"/>

                <TextBlock Text="Delta (0.5 - 3Hz)"/>
                <ProgressBar Value="{Binding Delta}" Maximum="2000000" Foreground="Red"/>

                <TextBlock Text="Theta (4 - 7Hz)"/>
                <ProgressBar Value="{Binding Theta}" Maximum="2000000" Foreground="Orange"/>

                <TextBlock Text="Low Alpha (8 - 9Hz)"/>
                <ProgressBar Value="{Binding LowAlpha}" Maximum="50000" Foreground="Yellow"/>

                <TextBlock Text="High Alpha (10 - 12Hz)"/>
                <ProgressBar Value="{Binding HighAlpha}" Maximum="50000" Foreground="Lime"/>

                <TextBlock Text="Low Beta (13 - 17Hz)"/>
                <ProgressBar Value="{Binding LowBeta}" Maximum="30000" Foreground="Cyan"/>

                <TextBlock Text="High Beta (18 - 30Hz)"/>
                <ProgressBar Value="{Binding HighBeta}" Maximum="30000" Foreground="Blue"/>

                <TextBlock Text="Low Gamma (31 - 40Hz)"/>
                <ProgressBar Value="{Binding LowGamma}" Maximum="10000" Foreground="Purple"/>

                <TextBlock Text="High Gamma (41 - 50Hz)"/>
                <ProgressBar Value="{Binding HighGamma}" Maximum="10000" Foreground="Violet"/>
            </StackPanel>
        </ScrollViewer>

    </Grid>
</Window>